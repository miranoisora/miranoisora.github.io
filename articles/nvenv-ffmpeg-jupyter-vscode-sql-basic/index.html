
<!DOCTYPE html>

    <html lang="zh-Hant-CN"></html>

    
<head>
    <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="雨天等放晴">
    <title>NVENV FFmpeg 配置 | Jupyter 和 VSCode 遠程登陸 | SQL 基礎 - 雨天等放晴</title>
    <meta name="author" content="Tang Huan">
    
        <meta name="keywords" content="FFmpeg,NVENC,Jupyter,VSCode,SQL,OpenCV">
    
    
        <link rel="icon" href="https://tangh.github.io/assets/images/favicon.png">
    
    
        <link rel="apple-touch-icon" sizes="180x180" href="https://tangh.github.io/assets/images/apple-touch-icon.png">
    
    
    <script type="application/ld+json">{"@context":"http://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Tang Huan","sameAs":["https://twitter.com/tanghrtx/","https://www.flickr.com/photos/135277712@N07/","https://www.instagram.com/tanghrtx/","https://www.youtube.com/channel/UCO-I0MZR6-HYmI_tgbBc0yw/","https://space.bilibili.com/634428/"],"image":"icon.jpg"},"articleBody":"\n\n這一個半月來開始頻繁接觸 Linux 和一些数據庫工具，整理一下。想想用 macOS 也快七年了，可能直到兩年前我才能稍微知道一點關於它文件层次的東西。\n從幾個文件目錄開始\nbin 放置可執行的二進制程序，可以直接運行；lib 是一些動態鏈接庫，其它程序依賴；include 則是一些 C 的頭文件，在編譯程序的時候，要 include 進來。\n/bin：zsh、ls、rm、mkdir，所有用戶可以使用的與系統相關的程序。/sbin：shutdown、ifconfig、mount，系統運行直接相關的需要 root 權限的程序/usr/bin：whereis、tar、clang、g++，系統預裝的程序。/usr/sbin 同樣為需要 root 權限的/usr/local/bin：ffmpeg、x264，一些自己安裝的第三方程序。/usr/local/sbin 同理\n此外一些包管理軟件，例如 Homebrew 安裝在 /usr/local/Cellar/ 下，並軟鏈接到 /usr/local/bin。一些大型的包管理軟件比如 Anaconda 會安裝在 /usr/local/opt 或 ~/opt 下。\n環境変量\n上述這些 bin 文件夾一般都是在 PATH 中的，所以打開 Terminal 直接敲指令就可以使用，不需要帶程序路徑，如果在其它地方的程序，就需要軟鏈接到這裡，或者把其它路徑加到 PATH 中，例如 ~/.zshrc 內 export PATH=&quot;/Users/kotori/opt/anaconda3/bin:$PATH。\n同樣的，在標準的動態鏈接庫內的 .so 也可以正常被其它需要調用的程序識別到，也可以軟鏈接或 export LD_LIBRARY_PATH=/mnt/x264-master:$LD_LIBRARY_PATH。\n用 Homebrew 時，如果檢測到系統已經安裝了某程序，那麼它就不會把 /usr/local/Cellar/ 內的程序鏈接到 /usr/local/bin，brew info opencv@3 顯示：\n12opencv@3 is keg-only, which means it was not symlinked into &#x2F;usr&#x2F;local, because this is an alternate version of another formula.&#x2F;usr&#x2F;local&#x2F;Cellar&#x2F;opencv@3&#x2F;3.4.5_6 (656 files, 235.6MB)\n\n這時候如果其它程序需要的話就要指定一下 -I/usr/local/Cellar/opencv@3/3.4.5_6/include，-L/usr/local/Cellar/opencv@3/3.4.5_6/lib\nFFmpeg with nvenc前幾個月聽說現在 NVENC 效果不錯了，配置了一個試試看，大概 6x 的速度，1.4x 的文件體積？對於不極致質量追求的地方應該說相當好用。官網：https://developer.nvidia.com/ffmpeg，https://trac.ffmpeg.org/wiki/HWAccelIntro\n用包管理器的好處就是它真的很貼心，常用的組件通通給配好了。自己編譯的話，每個依賴都要先手動裝好然後在 configure 裡 enable。但是目前包管理器安裝的 FFmpeg 一般都不會帶 GPU 編碼器。\n系統環境\nnvidia-smi driver 版本 Driver Version: 396.44nvcc -V  complier/cuda toolkit 版本 Cuda compilation tools, release 9.0, V9.0.176\n這裡有個坑點，nvenc API version 並不知道怎麼查看，而它直接關係到頭文件的版本，我隨便編譯了一個之後運行的時候顯示，這裡才看到是 8.1\n12[h264_nvenc @ 0x36d8640] Driver does not support the required nvenc API version. Required: 10.0 Found: 8.1[h264_nvenc @ 0x36d8640] The minimum required Nvidia driver for nvenc is 445.87 or newer\n\n然後重新搞了一個，反正也挺快的。。。\nDependencies編譯器\n除了 g++ 之外，ffmpeg 为了提高效率使用了汇编指令，如 MMX 和 SSE 等，所以先要安裝 yasm，x264 還需要 nasm，否則會報錯 nasm/yasm not found or too old. Use --disable-x86asm for a crippled build.\nyasm：Debian 下直接 sudo apt-get install yasm。\nnasm：http://www.nasm.us/，下載後直接運行 ./configure，尋找編譯器並生成相應 Makefile，然後 make 編譯，之後 make install 裝進 /usr/local/bin。\nx264\n我怎麼覺得 libavcodec 就帶了 x264 編解碼啊？但是實踐告訴我 Unknown encoder &#39;libx264&#39; 就是要單獨搞搞。\n總還是會用到 CPU 編碼，所以 git clone https://code.videolan.org/videolan/x264.git 得到源碼後，./configure --enable-static --enable-shared，然後 make -&gt; sudo make install 給它編譯安裝。\n這會生成 .a (Archive libraries ) 靜態編譯的程序會用到，和 .so (shared object) 的動態庫。\nlibmp3lame\n一個 mp3 的編碼器，總之 FFmpeg 啥都要自己配好才工作，apt-get install libmp3lame-dev 或者與 x264 一樣的安裝方式。它好像也可以 AAC，我試了下是 OK 的？\n頭文件\n然後 clone 一下頭文件 https://github.com/FFmpeg/nv-codec-headers，這裡知道系統裡的 API 是 8.1 的（上面那個系統環境版本簡直太「經典」了），所以 git checkout -b sdk/8.1 origin/sdk/8.1 把老版本的拉下來。\nCompile and Command把 FFmpeg clone 下來，然後配置啟動一下 x264、libmp3lame、nvenc，cuda 不在標準目錄要指定一下 -I 和 -L\n./configure --enable-cuda-nvcc --enable-cuvid --enable-nvenc --enable-nonfree --enable-libnpp --enable-gpl --enable-libx264 --enable-libmp3lame --extra-cflags=-I/usr/local/cuda/include --extra-ldflags=-L/usr/local/cuda/lib64\n生成 Makefile 後，make -j 10 -&gt; make install\n我這裡碰到奇怪情況，明明都 make install 了，但是好像沒在環境変量裡，而且 x264 也是，運行會顯示：./ffmpeg: error while loading shared libraries: libx264.so.161: cannot open shared object file: No such file or directory\nldd ./ffmpeg 看了下，顯示以下：\n123456linux-vdso.so.1 (0x00007fff12dac000)  ...  liblzma.so.5 &#x3D;&gt; &#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;liblzma.so.5 (0x00007f52f5bcf000)  libx264.so.161 &#x3D;&gt; not found  libpthread.so.0 &#x3D;&gt; &#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;libpthread.so.0 (0x00007f52f59b2000)  ...\n\n/usr/local/lib 裡明明有個 libx264.so soft link -&gt; libx264.so.161，不知道它為啥要找帶版本號後綴的。有說 /etc/ld.so.conf 加上 x264 clone 到的目錄然後 sudo ldconfig。感覺不如直接 export LD_LIBRARY_PATH=/mnt/x264-master:$LD_LIBRARY_PATH，然後把 FFmpeg 也 export 到 PATH 裡。\ncommand\nffmpeg -hwaccel cuvid -hwaccel_output_format cuda (-c:v h264_cuvid) -i a.avi -i b.mp4 -map 0:0 -map 1:1 -c:v h264_nvenc -c:a copy -y c.mp4\n啟用 GPU 編解碼，加上解碼也有不小速度提升，source 不是 h.264 的也有提升（去掉括號內的）。\nFFmpeg Static Builds官網上發現有個 static build，不用 GPU 的話不如直接用這玩意方便，什麼都帶。\nJupyter and VSCodeJupyter 和 VSCode 可以遠程連接到服務器作業，然後保存直接更改到服務器上。Jupyter 是啟動了一個 http 服務，然後在網頁上進行編輯，VSCode 用的是 SSH。不管怎樣都是比 Vim 方便不少。\nJupyter\n在網上看了一圈，發現都是莫名奇妙的配置方法，麻煩且，我感覺就多人共用一個 root 還是挺常見的吧，直接命令生成新的配置覆蓋不好吧。。其實它可以指定配置文件啟動。把底下的祖傳配置腳本隨便放到哪，然後 jupyter notebook --allow-root -y --ip=0.0.0.0 --config=&quot;&lt;path&gt;/jupyter_notebook_config.py&quot; 就好。其實只要有 --ip=0.0.0.0 甚至不需要後面的 config 它就會啟動一個可以遠程登陸的 kernel，這個 ip 默認是 localhost，寫 0 自動用本機 IP，端口 8888。下面的 config 主要是自定義一個端口和打開 Jupyter 之後的工作目錄。\n12345678910111213141516171819202122import osfrom IPython.lib import passwdc = get_config()# default is `localhost`, set to `0.0.0.0` to enable remote loginc.NotebookApp.ip = '0.0.0.0'# set an unique portc.NotebookApp.port = int(os.getenv('PORT', 12345))c.NotebookApp.open_browser = False# set jupyter workspace dirc.NotebookApp.notebook_dir = \"/data/docker/workspace\"# sets a password if PASSWORD is set in the environment# otherwise generate a login tokenif 'PASSWORD' in os.environ:  password = os.environ['PASSWORD']  if password:    c.NotebookApp.password = passwd(password)  else:    c.NotebookApp.password = ''    c.NotebookApp.token = ''  del os.environ['PASSWORD']\n\n運行之後會顯示下面的，它給出的 IP 和域名估計都不對，就 ifconfig 查一下服務器內網 IP，然後用指定的端口和它生成的 token 登陸即可，系統環境中配置了密碼按照上面的配置腳本會自動使用這個密碼。\n123[I 15:10:10.848 NotebookApp] Jupyter Notebook 6.1.1 is running at:[I 15:10:10.848 NotebookApp] http:&#x2F;&#x2F;&lt;machine-name&gt;:12345&#x2F;?token&#x3D;286418550b6a1ff2b767ddaeeb0c1dc2c493e774cbfd3c87[I 15:10:10.848 NotebookApp] or http:&#x2F;&#x2F;127.0.0.1:12345&#x2F;?token&#x3D;286418550b6a1ff2b767ddaeeb0c1dc2c493e774cbfd3c87\n\nVSCode\n還沒搞好，下週再搞搞，我還是喜歡 VSCode。\nSQL幹了這麼件事，給一個表中的部分信息搞到一個新表中。\n登陸 mysql -u root -p\n列出指定表的全部字段信息：\n123456SELECT  column_name, column_type, IS_NULLABLE, column_keyFROM  information_schema.columnsWHERE  table_schema= '&lt;database&gt;' AND table_name = '&lt;table_name&gt;'\n\n1234567+-------------+--------------+-------------+------------+| column_name | column_type  | IS_NULLABLE | column_key |+-------------+--------------+-------------+------------+| id          | bigint(20)   | NO          |            || title       | varchar(20)  | NO          |            || ctime       | timestamp    | NO          |            |+-------------+--------------+-------------+------------+\n\nPRI主键约束 UNI唯一约束 MUL可以重复\n創建一個新表\n12345678create table &lt;database&gt;.&lt;table_name&gt;(  id bigint(20) not null,  title varchar(20) not null,  pubtime timestamp not null,  ctime timestamp default CURRENT_TIMESTAMP,  mtime timestamp default CURRENT_TIMESTAMP);\n\n\n把查詢到的結果插入一個表\n1234567891011INSERT INTO  &lt;database&gt;.&lt;table_a&gt;  (id, title, ctime)SELECT  id,  title,  ctimeFROM  &lt;database&gt;.&lt;table_b&gt;WHERE  ctime='';\n\nReplace values to select.\n更改表的信息\n增加新列：ALTER TABLE &lt;database&gt;.&lt;table_name&gt; ADD &lt;col_name&gt; &lt;col_type&gt;;\n修改列名：ALTER TABLE &lt;database&gt;.&lt;table_name&gt; CHANGE &lt;col_name&gt; &lt;col_new_name&gt; &lt;col_new_type&gt;;\n刪除查找出的：DELETE FROM &lt;database&gt;.&lt;table_name&gt; WHERE &lt;&gt;;\nPresto/Hive也是才了解到這兩個東西，不過我之前連 MySQL 都用不上。。也合理。\n對於 Hive，DISTINCT 必須出現在第一個查詢的字段，否則 FAILED: ParseException line 4:24 cannot recognize input near &#39;DISTINCT&#39; &#39;(&#39; &#39;id&#39; in selection target。\n此外對於分區了的表，Hive 不允許不指定 WHERE 分區字段 查詢。FAILED: SemanticException Queries against partitioned tables without a partition filter are disabled for safety reasons.。\nMiscOpenCV\n最近發現 C++ 和 Python 的 OpenCV 有幾個不同的行為，很坑：\n對於 CV_8U np.uint8 的数據（顯然是最常見的一種），在 C++ 裡，如果減法向下越界，那麼會截斷，也就是 1 - 254 = 0；而在 Python 裡，會 1 - 254 = 2。\n此外，而有些自帶函数會轉換到一個更高的精度，導致結果不同。（Python）例如求兩個像素的 L2 距離，如果用自帶運算符 - 和 *，他們會在 uint8 下溢出。但如果 cv2.norm() 它會自動轉到一個高精度計算。也就是說 np.sqrt((a-b) * (a-b)) 和 cv2.norm((a-b)) 的結果不同，所以這種還是直接 cv2.norm(a, b) 比較好。\n儲存 dim &lt;= 3 的結果，float32 可以使用 TIFF 格式。下週來寫一個寫入文件的，C++ FORTA。\n此外這個月我覺得 channel first 好像是符合直覺一些，對 PyTorch 的喜愛又多了一點。我發現 Everyone hates TensorFlow 現在。\nLinux 自帶的幾個命令\nfind -name &quot;*.mp4&quot; -exec mv {} ./src \\; 會使用每個查找的結果放在 {} 中單獨執行後面的命令，以 \\; 結尾。\nnohup &lt;cmd&gt; &gt; logfile 2&gt;&amp;1 &amp;\ntar -cvf &lt;filename&gt;.tar &lt;dir_path&gt;，c 打包，x 解包，v 詳細信息，f 指定文件。z gz 壓縮，j bz2 (bunzip2) 壓縮，-C &lt;path&gt; 指定解包目錄，如果裡面文件很多可以創建一個目錄給它外面套一层文件夾。\nr 追加，find -name &quot;*.mp4&quot; -exec tar -rvf video.tar {} \\;，每個命令單獨執行的，所以要用追加。不過這裡 tar -rvf video.tar *.mp4 比較直接。u 替換，使用指定文件替換包中同名文件。\nr, u, c, x 選一種模式，f 必須要；有 gz 後綴加個 z，有 bz2 加 j；v 隨意。\nPackage Management\nMiniconda conda config --set auto_activate_base false，在 ~/.condarc 中配置。\napt list --installed\n","dateCreated":"2020-08-18T00:00:00+08:00","dateModified":"2020-08-22T12:37:01+08:00","datePublished":"2020-08-18T00:00:00+08:00","description":"一個連標題都不好起的紀錄大雜燴，有一些 Linux 基礎知識，FFmpeg + NVENC 的編譯配置，Jupyter 和 VSCode 遠程登陸服務器的配置，数據庫入門，碰到的一些坑點，等等。","headline":"NVENV FFmpeg 配置 | Jupyter 和 VSCode 遠程登陸 | SQL 基礎","image":[],"mainEntityOfPage":{"@type":"WebPage","@id":"https://tangh.github.io/articles/nvenv-ffmpeg-jupyter-vscode-sql-basic/"},"publisher":{"@type":"Organization","name":"Tang Huan","sameAs":["https://twitter.com/tanghrtx/","https://www.flickr.com/photos/135277712@N07/","https://www.instagram.com/tanghrtx/","https://www.youtube.com/channel/UCO-I0MZR6-HYmI_tgbBc0yw/","https://space.bilibili.com/634428/"],"image":"icon.jpg","logo":{"@type":"ImageObject","url":"icon.jpg"}},"url":"https://tangh.github.io/articles/nvenv-ffmpeg-jupyter-vscode-sql-basic/","keywords":"Linux, FFmpeg, Database"}</script>
    <meta name="description" content="一個連標題都不好起的紀錄大雜燴，有一些 Linux 基礎知識，FFmpeg + NVENC 的編譯配置，Jupyter 和 VSCode 遠程登陸服務器的配置，数據庫入門，碰到的一些坑點，等等。">
<meta property="og:type" content="blog">
<meta property="og:title" content="NVENV FFmpeg 配置 | Jupyter 和 VSCode 遠程登陸 | SQL 基礎">
<meta property="og:url" content="https:&#x2F;&#x2F;tangh.github.io&#x2F;articles&#x2F;nvenv-ffmpeg-jupyter-vscode-sql-basic&#x2F;">
<meta property="og:site_name" content="雨天等放晴">
<meta property="og:description" content="一個連標題都不好起的紀錄大雜燴，有一些 Linux 基礎知識，FFmpeg + NVENC 的編譯配置，Jupyter 和 VSCode 遠程登陸服務器的配置，数據庫入門，碰到的一些坑點，等等。">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2020-08-17T16:00:00.000Z">
<meta property="article:modified_time" content="2020-08-22T04:37:01.941Z">
<meta property="article:author" content="Tang Huan">
<meta property="article:tag" content="FFmpeg">
<meta property="article:tag" content="NVENC">
<meta property="article:tag" content="Jupyter">
<meta property="article:tag" content="VSCode">
<meta property="article:tag" content="SQL">
<meta property="article:tag" content="OpenCV">
<meta name="twitter:card" content="summary">
    
    
        
    
    
        <meta property="og:image" content="https://tangh.github.io/assets/images/icon.jpg"/>
    
    
    
    
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+JP:wght@400;700&family=Noto+Serif+SC:wght@400;700&display=swap" rel="stylesheet">
    <!--STYLES-->
    
<link rel="stylesheet" href="/assets/css/style-iaetwm81hfopcuajcp7qnh2zsnqn4dhiu3nftuj79wdhe7fie6l4r0thrs6g.min.css">

    <!--STYLES END-->
    
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-137837052-1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-137837052-1');
    </script><!-- hexo-inject:begin --><!-- hexo-inject:end -->


    

</head>

    <body>
        <!-- hexo-inject:begin --><!-- hexo-inject:end --><div id="blog">
            <!-- Define author's picture -->


    
        
            
        
    

<header id="header" data-behavior="4">
    <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
    <div class="header-title">
        <a
            class="header-title-link"
            href="/"
            aria-label=""
        >
            雨天等放晴
        </a>
    </div>
    
        
            <a
                class="header-right-picture "
                href="#about"
                aria-label="Open the link: /#about"
            >
        
        
            <img class="header-picture" src="/assets/images/icon.jpg" alt="Author&#39;s picture"/>
        
        </a>
    
</header>

            <!-- Define author's picture -->



        
    

<nav id="sidebar" data-behavior="4">
    <div class="sidebar-container">
        
            <div class="sidebar-profile">
                <a
                    href="/#about"
                    aria-label="Read more about the author"
                >
                    <img class="sidebar-profile-picture" src="/assets/images/icon.jpg" alt="Author&#39;s picture"/>
                </a>
                <h4 class="sidebar-profile-name">Tang Huan</h4>
                
                    <h5 class="sidebar-profile-bio"></h5>
                
            </div>
        
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/"
                            
                            rel="noopener"
                            title="Home"
                        >
                        <i class="sidebar-button-icon fa fa-home" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Home</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-categories"
                            
                            rel="noopener"
                            title="Categories"
                        >
                        <i class="sidebar-button-icon fa fa-bookmark" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Categories</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-tags"
                            
                            rel="noopener"
                            title="Tags"
                        >
                        <i class="sidebar-button-icon fa fa-tags" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Tags</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-archives"
                            
                            rel="noopener"
                            title="Archives"
                        >
                        <i class="sidebar-button-icon fa fa-archive" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Archives</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/about"
                            
                            rel="noopener"
                            title="About"
                        >
                        <i class="sidebar-button-icon fas fa-cube" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">About</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://twitter.com/tanghrtx/"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="Twitter"
                        >
                        <i class="sidebar-button-icon fab fa-twitter" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Twitter</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://www.flickr.com/photos/135277712@N07/"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="Flickr"
                        >
                        <i class="sidebar-button-icon fab fa-flickr" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Flickr</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://www.instagram.com/tanghrtx/"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="Instagram"
                        >
                        <i class="sidebar-button-icon fab fa-instagram" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Instagram</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://www.youtube.com/channel/UCO-I0MZR6-HYmI_tgbBc0yw/"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="YouTube"
                        >
                        <i class="sidebar-button-icon fab fa-youtube" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">YouTube</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://space.bilibili.com/634428/"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="BiliBili"
                        >
                        <i class="sidebar-button-icon fab fa-youtube-square" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">BiliBili</span>
                    </a>
            </li>
            
        </ul>
        
    </div>
</nav>

            
            <div id="main" data-behavior="4"
                 class="
                        hasCoverMetaIn
                        ">
                
<article class="post">
    
    
        <div class="post-header main-content-wrap text-center">
    
        <h1 class="post-title">
            NVENV FFmpeg 配置 | Jupyter 和 VSCode 遠程登陸 | SQL 基礎
        </h1>
    
    
        <div class="post-meta">
    <time datetime="2020-08-18T00:00:00+08:00">
	
		    Aug 18, 2020
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/Computer/">Computer</a>, <a class="category-link" href="/categories/Computer/Programming/">Programming</a>


    
</div>

    
</div>

    
    
        <div class="post-content markdown">
    
        <div class="main-content-wrap">
            <!-- excerpt -->

<p>這一個半月來開始頻繁接觸 Linux 和一些数據庫工具，整理一下。想想用 macOS 也快七年了，可能直到兩年前我才能稍微知道一點關於它文件层次的東西。</p>
<p><strong>從幾個文件目錄開始</strong></p>
<p><code>bin</code> 放置可執行的二進制程序，可以直接運行；<code>lib</code> 是一些動態鏈接庫，其它程序依賴；<code>include</code> 則是一些 C 的頭文件，在編譯程序的時候，要 include 進來。</p>
<p><code>/bin</code>：zsh、ls、rm、mkdir，所有用戶可以使用的與系統相關的程序。<code>/sbin</code>：shutdown、ifconfig、mount，系統運行直接相關的需要 root 權限的程序<br><code>/usr/bin</code>：whereis、tar、clang、g++，系統預裝的程序。<code>/usr/sbin</code> 同樣為需要 root 權限的<br><code>/usr/local/bin</code>：ffmpeg、x264，一些自己安裝的第三方程序。<code>/usr/local/sbin</code> 同理</p>
<p>此外一些包管理軟件，例如 Homebrew 安裝在 <code>/usr/local/Cellar/</code> 下，並軟鏈接到 <code>/usr/local/bin</code>。一些大型的包管理軟件比如 Anaconda 會安裝在 <code>/usr/local/opt</code> 或 <code>~/opt</code> 下。</p>
<p><strong>環境変量</strong></p>
<p>上述這些 bin 文件夾一般都是在 PATH 中的，所以打開 Terminal 直接敲指令就可以使用，不需要帶程序路徑，如果在其它地方的程序，就需要軟鏈接到這裡，或者把其它路徑加到 PATH 中，例如 <code>~/.zshrc</code> 內 <code>export PATH=&quot;/Users/kotori/opt/anaconda3/bin:$PATH</code>。</p>
<p>同樣的，在標準的動態鏈接庫內的 <code>.so</code> 也可以正常被其它需要調用的程序識別到，也可以軟鏈接或 <code>export LD_LIBRARY_PATH=/mnt/x264-master:$LD_LIBRARY_PATH</code>。</p>
<p>用 Homebrew 時，如果檢測到系統已經安裝了某程序，那麼它就不會把 <code>/usr/local/Cellar/</code> 內的程序鏈接到 <code>/usr/local/bin</code>，<code>brew info opencv@3</code> 顯示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">opencv@3 is keg-only, which means it was not symlinked into &#x2F;usr&#x2F;local, because this is an alternate version of another formula.</span><br><span class="line">&#x2F;usr&#x2F;local&#x2F;Cellar&#x2F;opencv@3&#x2F;3.4.5_6 (656 files, 235.6MB)</span><br></pre></td></tr></table></figure>

<p>這時候如果其它程序需要的話就要指定一下 <code>-I/usr/local/Cellar/opencv@3/3.4.5_6/include</code>，<code>-L/usr/local/Cellar/opencv@3/3.4.5_6/lib</code></p>
<h1 id="FFmpeg-with-nvenc"><a href="#FFmpeg-with-nvenc" class="headerlink" title="FFmpeg with nvenc"></a>FFmpeg with nvenc</h1><p>前幾個月聽說現在 NVENC 效果不錯了，配置了一個試試看，大概 6x 的速度，1.4x 的文件體積？對於不極致質量追求的地方應該說相當好用。官網：<a href="https://developer.nvidia.com/ffmpeg，https://trac.ffmpeg.org/wiki/HWAccelIntro" target="_blank" rel="noopener">https://developer.nvidia.com/ffmpeg，https://trac.ffmpeg.org/wiki/HWAccelIntro</a></p>
<p>用包管理器的好處就是它真的很貼心，常用的組件通通給配好了。自己編譯的話，每個依賴都要先手動裝好然後在 configure 裡 enable。但是目前包管理器安裝的 FFmpeg 一般都不會帶 GPU 編碼器。</p>
<p><strong>系統環境</strong></p>
<p><code>nvidia-smi</code> driver 版本 <code>Driver Version: 396.44</code><br><code>nvcc -V</code>  complier/cuda toolkit 版本 <code>Cuda compilation tools, release 9.0, V9.0.176</code></p>
<p>這裡有個坑點，<code>nvenc API version</code> 並不知道怎麼查看，而它直接關係到頭文件的版本，我隨便編譯了一個之後運行的時候顯示，這裡才看到是 8.1</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[h264_nvenc @ 0x36d8640] Driver does not support the required nvenc API version. Required: 10.0 Found: 8.1</span><br><span class="line">[h264_nvenc @ 0x36d8640] The minimum required Nvidia driver for nvenc is 445.87 or newer</span><br></pre></td></tr></table></figure>

<p>然後重新搞了一個，反正也挺快的。。。</p>
<h2 id="Dependencies"><a href="#Dependencies" class="headerlink" title="Dependencies"></a>Dependencies</h2><p><strong>編譯器</strong></p>
<p>除了 g++ 之外，ffmpeg 为了提高效率使用了汇编指令，如 MMX 和 SSE 等，所以先要安裝 yasm，x264 還需要 nasm，否則會報錯 <code>nasm/yasm not found or too old. Use --disable-x86asm for a crippled build.</code></p>
<p>yasm：Debian 下直接 <code>sudo apt-get install yasm</code>。</p>
<p>nasm：<a href="http://www.nasm.us/，下載後直接運行" target="_blank" rel="noopener">http://www.nasm.us/，下載後直接運行</a> <code>./configure</code>，尋找編譯器並生成相應 Makefile，然後 <code>make</code> 編譯，之後 <code>make install</code> 裝進 <code>/usr/local/bin</code>。</p>
<p><strong>x264</strong></p>
<p>我怎麼覺得 libavcodec 就帶了 x264 編解碼啊？但是實踐告訴我 <code>Unknown encoder &#39;libx264&#39;</code> 就是要單獨搞搞。</p>
<p>總還是會用到 CPU 編碼，所以 <code>git clone https://code.videolan.org/videolan/x264.git</code> 得到源碼後，<code>./configure --enable-static --enable-shared</code>，然後 <code>make</code> -&gt; <code>sudo make install</code> 給它編譯安裝。</p>
<p>這會生成 <code>.a</code> (Archive libraries ) 靜態編譯的程序會用到，和 <code>.so</code> (shared object) 的<a href="https://en.wikipedia.org/wiki/Library_(computing)#Dynamic_linking" target="_blank" rel="noopener">動態庫</a>。</p>
<p><strong>libmp3lame</strong></p>
<p>一個 mp3 的編碼器，總之 FFmpeg 啥都要自己配好才工作，<code>apt-get install libmp3lame-dev</code> 或者與 x264 一樣的安裝方式。它好像也可以 AAC，我試了下是 OK 的？</p>
<p><strong>頭文件</strong></p>
<p>然後 clone 一下頭文件 <code>https://github.com/FFmpeg/nv-codec-headers</code>，這裡知道系統裡的 API 是 8.1 的（上面那個系統環境版本簡直太「經典」了），所以 <code>git checkout -b sdk/8.1 origin/sdk/8.1</code> 把老版本的拉下來。</p>
<h2 id="Compile-and-Command"><a href="#Compile-and-Command" class="headerlink" title="Compile and Command"></a>Compile and Command</h2><p>把 FFmpeg clone 下來，然後配置啟動一下 x264、libmp3lame、nvenc，cuda 不在標準目錄要指定一下 <code>-I</code> 和 <code>-L</code></p>
<p><code>./configure --enable-cuda-nvcc --enable-cuvid --enable-nvenc --enable-nonfree --enable-libnpp --enable-gpl --enable-libx264 --enable-libmp3lame --extra-cflags=-I/usr/local/cuda/include --extra-ldflags=-L/usr/local/cuda/lib64</code></p>
<p>生成 Makefile 後，<code>make -j 10</code> -&gt; <code>make install</code></p>
<p>我這裡碰到奇怪情況，明明都 <code>make install</code> 了，但是好像沒在環境変量裡，而且 x264 也是，運行會顯示：<code>./ffmpeg: error while loading shared libraries: libx264.so.161: cannot open shared object file: No such file or directory</code></p>
<p><code>ldd ./ffmpeg</code> 看了下，顯示以下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">linux-vdso.so.1 (0x00007fff12dac000)</span><br><span class="line">  ...</span><br><span class="line">  liblzma.so.5 &#x3D;&gt; &#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;liblzma.so.5 (0x00007f52f5bcf000)</span><br><span class="line">  libx264.so.161 &#x3D;&gt; not found</span><br><span class="line">  libpthread.so.0 &#x3D;&gt; &#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;libpthread.so.0 (0x00007f52f59b2000)</span><br><span class="line">  ...</span><br></pre></td></tr></table></figure>

<p><code>/usr/local/lib</code> 裡明明有個 <code>libx264.so</code> soft link -&gt; <code>libx264.so.161</code>，不知道它為啥要找帶版本號後綴的。有說 <code>/etc/ld.so.conf</code> 加上 x264 clone 到的目錄然後 <code>sudo ldconfig</code>。感覺不如直接 <code>export LD_LIBRARY_PATH=/mnt/x264-master:$LD_LIBRARY_PATH</code>，然後把 FFmpeg 也 export 到 PATH 裡。</p>
<p><strong>command</strong></p>
<p><code>ffmpeg -hwaccel cuvid -hwaccel_output_format cuda (-c:v h264_cuvid) -i a.avi -i b.mp4 -map 0:0 -map 1:1 -c:v h264_nvenc -c:a copy -y c.mp4</code></p>
<p>啟用 GPU 編解碼，加上解碼也有不小速度提升，source 不是 h.264 的也有提升（去掉括號內的）。</p>
<h2 id="FFmpeg-Static-Builds"><a href="#FFmpeg-Static-Builds" class="headerlink" title="FFmpeg Static Builds"></a>FFmpeg Static Builds</h2><p>官網上發現有個 <a href="https://johnvansickle.com/ffmpeg/" target="_blank" rel="noopener">static build</a>，不用 GPU 的話不如直接用這玩意方便，什麼都帶。</p>
<h1 id="Jupyter-and-VSCode"><a href="#Jupyter-and-VSCode" class="headerlink" title="Jupyter and VSCode"></a>Jupyter and VSCode</h1><p>Jupyter 和 VSCode 可以遠程連接到服務器作業，然後保存直接更改到服務器上。Jupyter 是啟動了一個 http 服務，然後在網頁上進行編輯，VSCode 用的是 SSH。不管怎樣都是比 Vim 方便不少。</p>
<p><strong>Jupyter</strong></p>
<p>在網上看了一圈，發現都是莫名奇妙的配置方法，麻煩且，我感覺就多人共用一個 root 還是挺常見的吧，直接命令生成新的配置覆蓋不好吧。。其實它可以指定配置文件啟動。把底下的祖傳配置腳本隨便放到哪，然後 <code>jupyter notebook --allow-root -y --ip=0.0.0.0 --config=&quot;&lt;path&gt;/jupyter_notebook_config.py&quot;</code> 就好。其實只要有 <code>--ip=0.0.0.0</code> 甚至不需要後面的 config 它就會啟動一個可以遠程登陸的 kernel，這個 ip 默認是 localhost，寫 0 自動用本機 IP，端口 <code>8888</code>。下面的 config 主要是自定義一個端口和打開 Jupyter 之後的工作目錄。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> IPython.lib <span class="keyword">import</span> passwd</span><br><span class="line"></span><br><span class="line">c = get_config()</span><br><span class="line"><span class="comment"># default is `localhost`, set to `0.0.0.0` to enable remote login</span></span><br><span class="line">c.NotebookApp.ip = <span class="string">'0.0.0.0'</span></span><br><span class="line"><span class="comment"># set an unique port</span></span><br><span class="line">c.NotebookApp.port = int(os.getenv(<span class="string">'PORT'</span>, <span class="number">12345</span>))</span><br><span class="line">c.NotebookApp.open_browser = <span class="literal">False</span></span><br><span class="line"><span class="comment"># set jupyter workspace dir</span></span><br><span class="line">c.NotebookApp.notebook_dir = <span class="string">"/data/docker/workspace"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># sets a password if PASSWORD is set in the environment</span></span><br><span class="line"><span class="comment"># otherwise generate a login token</span></span><br><span class="line"><span class="keyword">if</span> <span class="string">'PASSWORD'</span> <span class="keyword">in</span> os.environ:</span><br><span class="line">  password = os.environ[<span class="string">'PASSWORD'</span>]</span><br><span class="line">  <span class="keyword">if</span> password:</span><br><span class="line">    c.NotebookApp.password = passwd(password)</span><br><span class="line">  <span class="keyword">else</span>:</span><br><span class="line">    c.NotebookApp.password = <span class="string">''</span></span><br><span class="line">    c.NotebookApp.token = <span class="string">''</span></span><br><span class="line">  <span class="keyword">del</span> os.environ[<span class="string">'PASSWORD'</span>]</span><br></pre></td></tr></table></figure>

<p>運行之後會顯示下面的，它給出的 IP 和域名估計都不對，就 <code>ifconfig</code> 查一下服務器內網 IP，然後用指定的端口和它生成的 token 登陸即可，系統環境中配置了密碼按照上面的配置腳本會自動使用這個密碼。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[I 15:10:10.848 NotebookApp] Jupyter Notebook 6.1.1 is running at:</span><br><span class="line">[I 15:10:10.848 NotebookApp] http:&#x2F;&#x2F;&lt;machine-name&gt;:12345&#x2F;?token&#x3D;286418550b6a1ff2b767ddaeeb0c1dc2c493e774cbfd3c87</span><br><span class="line">[I 15:10:10.848 NotebookApp] or http:&#x2F;&#x2F;127.0.0.1:12345&#x2F;?token&#x3D;286418550b6a1ff2b767ddaeeb0c1dc2c493e774cbfd3c87</span><br></pre></td></tr></table></figure>

<p><strong>VSCode</strong></p>
<p>還沒搞好，下週再搞搞，我還是喜歡 VSCode。</p>
<h1 id="SQL"><a href="#SQL" class="headerlink" title="SQL"></a>SQL</h1><p>幹了這麼件事，給一個表中的部分信息搞到一個新表中。</p>
<p>登陸 <code>mysql -u root -p</code></p>
<p>列出指定表的全部字段信息：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">  column_name, column_type, IS_NULLABLE, column_key</span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">  information_schema.columns</span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">  table_schema= <span class="string">'&lt;database&gt;'</span> <span class="keyword">AND</span> table_name = <span class="string">'&lt;table_name&gt;'</span></span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">+-------------+--------------+-------------+------------+</span><br><span class="line">| column_name | column_type  | IS_NULLABLE | column_key |</span><br><span class="line">+-------------+--------------+-------------+------------+</span><br><span class="line">| id          | bigint(20)   | NO          |            |</span><br><span class="line">| title       | varchar(20)  | NO          |            |</span><br><span class="line">| ctime       | timestamp    | NO          |            |</span><br><span class="line">+-------------+--------------+-------------+------------+</span><br></pre></td></tr></table></figure>

<p>PRI主键约束 UNI唯一约束 MUL可以重复</p>
<p><strong>創建一個新表</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> &lt;<span class="keyword">database</span>&gt;.&lt;table_name&gt;</span><br><span class="line">(</span><br><span class="line">  <span class="keyword">id</span> <span class="built_in">bigint</span>(<span class="number">20</span>) <span class="keyword">not</span> <span class="literal">null</span>,</span><br><span class="line">  title <span class="built_in">varchar</span>(<span class="number">20</span>) <span class="keyword">not</span> <span class="literal">null</span>,</span><br><span class="line">  pubtime <span class="built_in">timestamp</span> <span class="keyword">not</span> <span class="literal">null</span>,</span><br><span class="line">  ctime <span class="built_in">timestamp</span> <span class="keyword">default</span> <span class="keyword">CURRENT_TIMESTAMP</span>,</span><br><span class="line">  mtime <span class="built_in">timestamp</span> <span class="keyword">default</span> <span class="keyword">CURRENT_TIMESTAMP</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>


<p><strong>把查詢到的結果插入一個表</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span></span><br><span class="line">  &lt;<span class="keyword">database</span>&gt;.&lt;table_a&gt;</span><br><span class="line">  (<span class="keyword">id</span>, title, ctime)</span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">  <span class="keyword">id</span>,</span><br><span class="line">  title,</span><br><span class="line">  ctime</span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">  &lt;<span class="keyword">database</span>&gt;.&lt;table_b&gt;</span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">  ctime=<span class="string">''</span>;</span><br></pre></td></tr></table></figure>

<p>Replace <code>values</code> to <code>select</code>.</p>
<p><strong>更改表的信息</strong></p>
<p>增加新列：<code>ALTER TABLE &lt;database&gt;.&lt;table_name&gt; ADD &lt;col_name&gt; &lt;col_type&gt;;</code></p>
<p>修改列名：<code>ALTER TABLE &lt;database&gt;.&lt;table_name&gt; CHANGE &lt;col_name&gt; &lt;col_new_name&gt; &lt;col_new_type&gt;;</code></p>
<p>刪除查找出的：<code>DELETE FROM &lt;database&gt;.&lt;table_name&gt; WHERE &lt;&gt;;</code></p>
<h2 id="Presto-Hive"><a href="#Presto-Hive" class="headerlink" title="Presto/Hive"></a>Presto/Hive</h2><p>也是才了解到這兩個東西，不過我之前連 MySQL 都用不上。。也合理。</p>
<p>對於 Hive，<code>DISTINCT</code> 必須出現在第一個查詢的字段，否則 <code>FAILED: ParseException line 4:24 cannot recognize input near &#39;DISTINCT&#39; &#39;(&#39; &#39;id&#39; in selection target</code>。</p>
<p>此外對於分區了的表，Hive 不允許不指定 WHERE 分區字段 查詢。<code>FAILED: SemanticException Queries against partitioned tables without a partition filter are disabled for safety reasons.</code>。</p>
<h1 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h1><p><strong>OpenCV</strong></p>
<p>最近發現 C++ 和 Python 的 OpenCV 有幾個不同的行為，很坑：</p>
<p>對於 <code>CV_8U</code> <code>np.uint8</code> 的数據（顯然是最常見的一種），在 C++ 裡，如果減法向下越界，那麼會截斷，也就是 <code>1 - 254 = 0</code>；而在 Python 裡，會 <code>1 - 254 = 2</code>。</p>
<p>此外，而有些自帶函数會轉換到一個更高的精度，導致結果不同。（Python）例如求兩個像素的 L2 距離，如果用自帶運算符 <code>-</code> 和 <code>*</code>，他們會在 <code>uint8</code> 下溢出。但如果 <code>cv2.norm()</code> 它會自動轉到一個高精度計算。也就是說 <code>np.sqrt((a-b) * (a-b))</code> 和 <code>cv2.norm((a-b))</code> 的結果不同，所以這種還是直接 <code>cv2.norm(a, b)</code> 比較好。</p>
<p>儲存 <code>dim &lt;= 3</code> 的結果，float32 可以使用 TIFF 格式。下週來寫一個寫入文件的，C++ FORTA。</p>
<p>此外這個月我覺得 channel first 好像是符合直覺一些，對 PyTorch 的喜愛又多了一點。我發現 Everyone hates TensorFlow 現在。</p>
<p><strong>Linux 自帶的幾個命令</strong></p>
<p><code>find -name &quot;*.mp4&quot; -exec mv {} ./src \;</code> 會使用每個查找的結果放在 <code>{}</code> 中單獨執行後面的命令，以 <code>\;</code> 結尾。</p>
<p><code>nohup &lt;cmd&gt; &gt; logfile 2&gt;&amp;1 &amp;</code></p>
<p><code>tar -cvf &lt;filename&gt;.tar &lt;dir_path&gt;</code>，<code>c</code> 打包，<code>x</code> 解包，<code>v</code> 詳細信息，<code>f</code> 指定文件。<code>z</code> gz 壓縮，<code>j</code> bz2 (bunzip2) 壓縮，<code>-C &lt;path&gt;</code> 指定解包目錄，如果裡面文件很多可以創建一個目錄給它外面套一层文件夾。</p>
<p><code>r</code> 追加，<code>find -name &quot;*.mp4&quot; -exec tar -rvf video.tar {} \;</code>，每個命令單獨執行的，所以要用追加。不過這裡 <code>tar -rvf video.tar *.mp4</code> 比較直接。<code>u</code> 替換，使用指定文件替換包中同名文件。</p>
<p><code>r, u, c, x</code> 選一種模式，<code>f</code> 必須要；有 gz 後綴加個 <code>z</code>，有 bz2 加 <code>j</code>；<code>v</code> 隨意。</p>
<p><strong>Package Management</strong></p>
<p>Miniconda <code>conda config --set auto_activate_base false</code>，在 <code>~/.condarc</code> 中配置。</p>
<p><code>apt list --installed</code></p>
<br/>
            


        </div>
    </div>
    <div id="post-footer" class="post-footer main-content-wrap">
        
            <div class="post-footer-tags">
                <span class="text-color-light text-small">TAGGED IN</span><br/>
                
    <a class="tag tag--primary tag--small t-link" href="/tags/Database/" rel="tag">Database</a> <a class="tag tag--primary tag--small t-link" href="/tags/FFmpeg/" rel="tag">FFmpeg</a> <a class="tag tag--primary tag--small t-link" href="/tags/Linux/" rel="tag">Linux</a>

            </div>
        
        
            <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    <a
                        class="post-action-btn btn btn--disabled"
                        aria-hidden="true"
                    >
                        
                        <i class="fa fa-angle-left" aria-hidden="true"></i>
                        <span class="hide-xs hide-sm text-small icon-ml">PREVIOUS</span>
                    </a>
            </li>
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/articles/create-high-quality-live-photos/"
                    data-tooltip="生成高質量的 Live Photo 的方法"
                    aria-label="NEXT: 生成高質量的 Live Photo 的方法"
                >
                    
                        <span class="hide-xs hide-sm text-small icon-mr">NEXT</span>
                        <i class="fa fa-angle-right" aria-hidden="true"></i>
                    </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a
                class="post-action-btn btn btn--default btn-open-shareoptions"
                href="#btn-open-shareoptions"
                aria-label="Share this post"
            >
                <i class="fa fa-share-alt" aria-hidden="true"></i>
            </a>
        </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://tangh.github.io/articles/nvenv-ffmpeg-jupyter-vscode-sql-basic/"
                    title="Share on Facebook"
                    aria-label="Share on Facebook"
                >
                    <i class="fab fa-facebook" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://twitter.com/intent/tweet?text=https://tangh.github.io/articles/nvenv-ffmpeg-jupyter-vscode-sql-basic/"
                    title="Share on Twitter"
                    aria-label="Share on Twitter"
                >
                    <i class="fab fa-twitter" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="http://service.weibo.com/share/share.php?&amp;title=https://tangh.github.io/articles/nvenv-ffmpeg-jupyter-vscode-sql-basic/"
                    title="Share on Weibo"
                    aria-label="Share on Weibo"
                >
                    <i class="fab fa-weibo" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="http://connect.qq.com/widget/shareqq/index.html?url=https://tangh.github.io/articles/nvenv-ffmpeg-jupyter-vscode-sql-basic/&amp;title=NVENV FFmpeg 配置 | Jupyter 和 VSCode 遠程登陸 | SQL 基礎"
                    title="Share on QQ"
                    aria-label="Share on QQ"
                >
                    <i class="fab fa-qq" aria-hidden="true"></i>
                </a>
            </li>
        
        
            
                <li class="post-action">
                    <a
                        class="post-action-btn btn btn--default"
                        href="#gitalk"
                        aria-label="Leave a comment"
                    >
                        <i class="fa fa-comment"></i>
                    </a>
                </li>
            
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#" aria-label="Back to top">
            
                <i class="fa fa-list" aria-hidden="true"></i>
            </a>
        </li>
    </ul>
</div>


        
        
            
                <div id="gitalk"></div>

            
        
    </div>
</article>



                <footer id="footer" class="main-content-wrap">
    <span class="copyrights">
        Copyrights &copy; 2020 Tang Huan. All Rights Reserved.
    </span>
</footer>

            </div>
            
                <div id="bottom-bar" class="post-bottom-bar" data-behavior="4">
                    <div class="post-bar-actions-wrap">
    <div class="post-actions post-action-share">
        <div class="post-action">
            
                <a class="post-bar-action-btn btn btn--default" href="#" aria-label="Back to top">
            
                <i class="fas fa-angle-up" aria-hidden="true"></i>
            </a>
        </div>
        
            
                <div class="post-action">
                    <a 
                        class="post-bar-action-btn btn btn--default"
                        href="#gitalk"
                        aria-label="Leave a comment"
                    >
                         <i class="fas fa-angle-down"></i>
                    </a>
                </div>
            
        
    </div>
</div>
                </div>
                
    <div id="share-options-bar" class="share-options-bar" data-behavior="4">
        <i id="btn-close-shareoptions" class="fa fa-times"></i>
        <ul class="share-options">
            
                
                
                <li class="share-option">
                    <a
                        class="share-option-btn"
                        target="new"
                        href="https://www.facebook.com/sharer/sharer.php?u=https://tangh.github.io/articles/nvenv-ffmpeg-jupyter-vscode-sql-basic/"
                        aria-label="Share on Facebook"
                    >
                        <i class="fab fa-facebook" aria-hidden="true"></i><span>Share on Facebook</span>
                    </a>
                </li>
            
                
                
                <li class="share-option">
                    <a
                        class="share-option-btn"
                        target="new"
                        href="https://twitter.com/intent/tweet?text=https://tangh.github.io/articles/nvenv-ffmpeg-jupyter-vscode-sql-basic/"
                        aria-label="Share on Twitter"
                    >
                        <i class="fab fa-twitter" aria-hidden="true"></i><span>Share on Twitter</span>
                    </a>
                </li>
            
                
                
                <li class="share-option">
                    <a
                        class="share-option-btn"
                        target="new"
                        href="http://service.weibo.com/share/share.php?&amp;title=https://tangh.github.io/articles/nvenv-ffmpeg-jupyter-vscode-sql-basic/"
                        aria-label="Share on Weibo"
                    >
                        <i class="fab fa-weibo" aria-hidden="true"></i><span>Share on Weibo</span>
                    </a>
                </li>
            
                
                
                <li class="share-option">
                    <a
                        class="share-option-btn"
                        target="new"
                        href="http://connect.qq.com/widget/shareqq/index.html?url=https://tangh.github.io/articles/nvenv-ffmpeg-jupyter-vscode-sql-basic/&amp;title=NVENV FFmpeg 配置 | Jupyter 和 VSCode 遠程登陸 | SQL 基礎"
                        aria-label="Share on QQ"
                    >
                        <i class="fab fa-qq" aria-hidden="true"></i><span>Share on QQ</span>
                    </a>
                </li>
            
        </ul>
    </div>


            
        </div>
        


    
        
    

<div id="about">
    <div id="about-card">
        <div id="about-btn-close">
            <i class="fa fa-times"></i>
        </div>
        
            <img id="about-card-picture" src="/assets/images/icon.jpg" alt="Author&#39;s picture"/>
        
            <h4 id="about-card-name">Tang Huan</h4>
        
            <div id="about-card-bio"></div>
        
        
            <div id="about-card-job">
                <i class="fa fa-briefcase"></i>
                <br/>
                
            </div>
        
        
            <div id="about-card-location">
                <i class="fa fa-map-marker-alt"></i>
                <br/>
                Shanghai
            </div>
        
    </div>
</div>

        
        
<div id="cover" style="background-image:url('/assets/images/cover.jpg');"></div>
        

<!--SCRIPTS-->

<script src="/assets/js/script-21vlobaq8sfmdbypn0z91hl6jyot6shixuux8ijser2jcbktmikbwlb6yvjx.min.js"></script>

<!--SCRIPTS END-->


    
      <script type="text/javascript">
        (function() {
          function render() {
            new Gitalk({
              clientID: 'b7b365f41dbbfaaf9b88',
              clientSecret: '25de272b8030e3c498dd56b883e4386d881b6d62',
              repo: 'tangh.github.io',
              owner: 'tangh',
              admin: ['tangh'],
              id: 'articles/nvenv-ffmpeg-jupyter-vscode-sql-basic',
              title: document.title.replace(' - 雨天等放晴', ''),
              ...{"language":"en","perPage":10,"distractionFreeMode":false,"enableHotKey":true,"pagerDirection":"first","createIssueManually":true}
            }).render('gitalk');
          }
          var gc = document.createElement('script');
          gc.type = 'text/javascript';
          gc.src = '//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js';
          gc.charset = 'UTF-8';
          gc.onload = render;
          gc.async = true;
          document.querySelector('body').appendChild(gc);
          var gcs = document.createElement('link');
          gcs.href = '//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css';
          gcs.type = 'text/css';
          gcs.rel = 'stylesheet';
          gcs.media = 'screen,print';
          document.querySelector('head').appendChild(gcs);
        })();
      </script><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config("");
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->
    




    <script>!function(e){var c=Array.prototype.slice.call(document.querySelectorAll("img[data-original]"));function i(){for(var r=0;r<c.length;r++)t=c[r],(n=t.getBoundingClientRect()).top>=-n.height&&0<=n.left&&n.top<=1.5*(e.innerHeight||document.documentElement.clientHeight)&&function(){var t,n,e,i,o=c[r];t=o,n=function(){c=c.filter(function(t){return o!==t})},e=new Image,i=t.getAttribute("data-original"),e.onload=function(){t.src=i,n&&n()},e.src=i}();var t,n}i(),e.addEventListener("scroll",function(){var t,n;t=i,n=e,clearTimeout(t.tId),t.tId=setTimeout(function(){t.call(n)},500)})}(this);</script></body>
</html>
